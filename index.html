<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>DSI Media Repository ‚Äì Complete Implementation Guide</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
<script>mermaid.initialize({startOnLoad:true});</script>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
  :root {
    --primary-color: #007acc;
    --secondary-color: #28a745;
    --accent-color: #ffc107;
    --text-color: #333;
    --bg-light: #fafafa;
    --bg-medium: #f8f9fa;
    --bg-dark: #1a1a1a;
    --card-bg: #fff;
    --border-color: #e9ecef;
    --shadow-light: 0 2px 8px rgba(0,0,0,0.05);
    --shadow-medium: 0 2px 10px rgba(0,0,0,0.1);
  }

  html,body{
    margin:0;
    font-family: 'Poppins', sans-serif;
    background:var(--bg-light);
    color:var(--text-color);
    line-height:1.6;
  }
  header{
    background:var(--bg-dark);
    color:#fff;
    padding:1.5rem 2rem;
    position:sticky;
    top:0;
    z-index:1000;
    box-shadow:var(--shadow-medium);
  }
  h1{
    margin:0;
    font-size:1.8rem;
    font-weight:700;
  }
  .subtitle{
    margin:0.5rem 0 0 0;
    font-size:0.95rem;
    opacity:0.9;
  }
  nav{
    margin-top:1.2rem;
    display:flex;
    flex-wrap:wrap;
    gap:1rem;
  }
  nav a{
    color:#fff;
    text-decoration:none;
    font-size:0.9rem;
    padding:0.6rem 1.2rem;
    border-radius:6px;
    transition:background 0.2s ease, transform 0.2s ease;
    border:1px solid rgba(255,255,255,0.2);
  }
  nav a:hover{
    background:rgba(255,255,255,0.15);
    transform: translateY(-2px);
  }
  main{
    padding:2rem;
    max-width:1200px;
    margin:auto;
  }
  section{
    margin-bottom:4rem;
    background:var(--card-bg);
    padding:2.5rem;
    border-radius:10px;
    box-shadow:var(--shadow-light);
    border-left: 6px solid var(--primary-color);
  }
  h2{
    color:var(--primary-color);
    font-size:2rem;
    margin-bottom:1.5rem;
    border-bottom:3px solid var(--primary-color);
    padding-bottom:0.75rem;
    font-weight:700;
  }
  h3{
    color:var(--text-color);
    font-size:1.5rem;
    margin-top:2.5rem;
    margin-bottom:1.2rem;
    font-weight:600;
  }
  h4{
    color:var(--text-color);
    font-size:1.2rem;
    margin-top:1.8rem;
    margin-bottom:1rem;
    font-weight:600;
  }
  table{
    border-collapse:collapse;
    width:100%;
    margin:1.5rem 0;
    box-shadow:var(--shadow-light);
    border-radius:8px;
    overflow:hidden;
  }
  th,td{
    border:1px solid var(--border-color);
    padding:1rem;
    text-align:left;
  }
  th{
    background:var(--primary-color);
    color:#fff;
    font-weight:600;
    text-transform: uppercase;
    font-size:0.9rem;
  }
  tr:nth-child(even){
    background:var(--bg-medium);
  }
  code{
    font-family:'Fira Code', Monaco, Consolas, monospace;
    font-size:0.9rem;
    background:#eef;
    padding:0.2em 0.4em;
    border-radius:4px;
    color:#d63384;
  }
  pre{
    background: #2d2d2d; /* Dark background for code blocks */
    color: #f8f8f2; /* Light text for readability */
    padding:1.5rem;
    overflow-x:auto;
    border-radius:8px;
    border-left:5px solid var(--primary-color);
    margin:1.5rem 0;
    box-shadow: inset 0 0 10px rgba(0,0,0,0.1);
  }
  pre code{
    background:none;
    padding:0;
    color: inherit;
    font-size:0.95rem;
  }
  .mermaid{
    background:var(--card-bg);
    border:1px solid var(--border-color);
    padding:1.5rem;
    margin:1.5rem 0;
    border-radius:8px;
    text-align:center;
    box-shadow:var(--shadow-light);
  }
  ul,ol{
    margin:1rem 0;
    padding-left:1.5rem;
  }
  li{
    margin:0.75rem 0;
  }
  .toc{
    background:var(--bg-medium);
    padding:1.8rem;
    border-radius:10px;
    margin-bottom:3rem;
    box-shadow:var(--shadow-light);
    border:1px solid var(--border-color);
  }
  .toc h3{
    margin-top:0;
    color:var(--primary-color);
    border-bottom:1px solid var(--primary-color);
    padding-bottom:0.8rem;
    margin-bottom:1.5rem;
  }
  .toc ul{
    list-style:none;
    padding-left:0;
  }
  .toc li{
    margin:0.5rem 0;
  }
  .toc a{
    color:var(--primary-color);
    text-decoration:none;
    font-weight:500;
    transition:color 0.2s ease;
  }
  .toc a:hover{
    text-decoration:underline;
    color:var(--secondary-color);
  }
  .highlight{
    background:#fff3cd;
    padding:1.2rem;
    border-left:5px solid var(--accent-color);
    margin:1.5rem 0;
    border-radius:6px;
    color:#664d03;
  }
  .note{
    background:#d1e7dd;
    padding:1.2rem;
    border-left:5px solid var(--secondary-color);
    margin:1.5rem 0;
    border-radius:6px;
    color:#0f5132;
  }
  .warning{
    background:#f8d7da;
    padding:1.2rem;
    border-left:5px solid #dc3545;
    margin:1.5rem 0;
    border-radius:6px;
    color:#842029;
  }
  .cost-comparison{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(280px,1fr));
    gap:1.5rem;
    margin:2rem 0;
  }
  .cost-card{
    background:var(--card-bg);
    padding:1.8rem;
    border-radius:10px;
    border:2px solid var(--primary-color);
    box-shadow:var(--shadow-light);
    text-align:center;
    transition:transform 0.2s ease, box-shadow 0.2s ease;
  }
  .cost-card:hover{
    transform: translateY(-5px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.1);
  }
  .cost-card h4{
    margin-top:0;
    color:var(--primary-color);
    font-size:1.4rem;
    margin-bottom:1rem;
  }
  .cost-price{
    font-size:1.2rem;
    font-weight:bold;
    color:var(--secondary-color);
    margin-bottom:1rem;
  }
  .cost-card ul {
    list-style: none;
    padding: 0;
    margin-top: 1rem;
    text-align: left;
  }
  .cost-card ul li {
    margin-bottom: 0.5rem;
    font-size: 0.95rem;
    color: #555;
  }
  footer{
    background:var(--bg-dark);
    color:#fff;
    text-align:center;
    padding:2.5rem;
    margin-top:3rem;
    font-size:0.9rem;
  }
  footer p{
    margin:0.5rem 0;
    opacity:0.8;
  }

  /* Specific styles for Deployment Graphs */
  .deployment-graph-container {
    display: flex;
    flex-direction: column;
    gap: 3rem;
    margin-top: 2rem;
  }
  .deployment-graph-container h3 {
    text-align: center;
    color: var(--primary-color);
    font-size: 1.6rem;
    border-bottom: 2px dashed var(--border-color);
    padding-bottom: 0.8rem;
    margin-bottom: 1.5rem;
  }

  @media (max-width:768px){
    header{padding:1rem; text-align: center;}
    nav{flex-direction:column;gap:0.5rem; align-items: center;}
    main{padding:1rem}
    section{padding:1.5rem}
    h1{font-size:1.5rem;}
    h2{font-size:1.6rem;}
    h3{font-size:1.3rem;}
    .cost-comparison{grid-template-columns:1fr}
    table, th, td {
      display: block;
      width: 100%;
      box-sizing: border-box;
    }
    th {
      text-align: center;
      background: var(--primary-color);
      color: #fff;
    }
    td {
      text-align: center;
      border-bottom: 1px solid var(--border-color);
    }
    tr {
      margin-bottom: 1rem;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      overflow: hidden;
      display: block;
    }
    td:before {
      content: attr(data-label);
      font-weight: bold;
      display: inline-block;
      width: 120px; /* Adjust as needed */
      text-align: left;
    }
  }
</style>
</head>
<body>
<header>
  <h1>DSI Media Repository</h1>
  <p class="subtitle">Complete Implementation Guide ‚Äì Development & Production</p>
</header>

<main>

<div class="toc">
  <h3>üìã Table of Contents</h3>
  <ul>
    <li><a href="#executive-summary">1. Executive Summary</a></li>
    <li><a href="#architecture">2. System Architecture Overview</a></li>
    <li><a href="#repository-structure">3. Repository Structure</a></li>
    <li><a href="#workflows">4. Automated Workflow Processes</a></li>
    <li><a href="#implementation">5. Technical Implementation</a></li>
    <li><a href="#database">6. Database Design</a></li>
    <li><a href="#deployment">7. Deployment & Hosting Options</a></li>
    <li><a href="#security">8. Security & Compliance</a></li>
    <li><a href="#testing">9. Testing & Monitoring</a></li>
    <li><a href="#best-practices">10. Best Practices & Optimization</a></li>
  </ul>
</div>

<section id="executive-summary">
  <h2>üéØ Executive Summary</h2>
  <p>The <strong>DSI Media Repository Integration Architecture</strong> is an end‚Äëto‚Äëend automated pipeline for the first phase of automation workflows concerned with ingesting, analyzing, optimizing and distributing product media. It unifies Google Drive uploads, AI metadata enrichment, vector search, and CDN optimization while giving full traceability back to the source asset.</p>
  
  <h3>Core Technologies:</h3>
  <ul>
    <li><strong>Automated Processing</strong> ‚Äì Drive uploads trigger n8n workflows automatically</li>
    <li><strong>AI‚ÄëEnhanced Metadata</strong> ‚Äì OpenAI + Weaviate vectors, multilingual descriptions</li>
    <li><strong>CDN Optimisation</strong> ‚Äì Cloudinary auto‚Äëformats images &amp; video for web delivery</li>
    <li><strong>Scalable Architecture</strong> ‚Äì From $12 VPS to enterprise AWS deployment</li>
    <li><strong>Full Traceability</strong> ‚Äì Change‚Äëlog &amp; audit trail from upload to distribution</li>
  </ul>

</section>

<section id="architecture">
  <h2>üèóÔ∏è System Architecture Overview</h2>
  
  <h3>High‚ÄëLevel Architecture</h3>
  <div class="mermaid">
graph TB
    subgraph "Data Sources"
        GD[Google Drive<br/>DSI Product Repository]
        QNAP[QNAP NAS<br/>Backup Storage]
    end
    subgraph "Processing Layer"
        PS[Google Pub/Sub<br/>Event Transport]
        N8N[n8n Workflows<br/>Orchestration Engine]
        OAI[OpenAI<br/>AI Analysis]
    end
    subgraph "Storage Layer"
        WV[Weaviate<br/>Vector Database]
        PG[PostgreSQL<br/>Metadata & Logs]
        CDN[Cloudinary<br/>CDN & Optimisation]
    end
    subgraph "Notification Layer"
        GC[Google Chat<br/>Team Notifications]
    end
    GD -->|File Upload Event| PS
    PS -->|Trigger| N8N
    N8N -->|Send for Analysis| OAI
    N8N -->|Store Vectors| WV
    N8N -->|Log Metadata| PG
    N8N -->|Upload & Optimize| CDN
    N8N -->|Backup| QNAP
    N8N -->|Notify Team| GC
    N8N -->|Update Metadata| GD
    
    style GD fill:#e1f5fe
    style N8N fill:#f3e5f5
    style WV fill:#e8f5e8
    style PG fill:#fff3e0
    style CDN fill:#fce4ec
    style PS fill:#cceeff
    style OAI fill:#ffebcc
    style QNAP fill:#e6e6e6
    style GC fill:#d3f5e9
  </div>

  <h3>High-Level Data Flow</h3>
  <ol>
    <li>Drive Upload</li>
    <li>Pub/Sub Trigger</li>
    <li>n8n Processing</li>
    <li>Vector Storage</li>
    <li>Metadata DB</li>
    <li>Drive Feedback</li>
  </ol>
</section>

<section id="repository-structure">
  <h2>üìÅ Repository Structure</h2>
  
  <div class="mermaid">
graph TD
    Root[DSI-Product-Repository]
    
    subgraph "System Folders"
        Meta[Metadata/]
        Proc[Processed-Media/]
    end
    
    subgraph "Product Palaces"
        PF[Palace-of-Fragrances/]
        PP[Palace-of-Precision/]
        PS[Palace-of-Style/]
    end
    
    subgraph "Metadata Structure"
        Meta --> Tag[Tagging-Data/]
        Meta --> AI[AI-Generated-Tags/]
        Meta --> Multi[Multilingual-Descriptions/]
        Meta --> Ver[Version-Control/]
        Meta --> Change[Media-Change-History/]
        Meta --> Approval[Approval-Stages/]
    end
    
    subgraph "Processed Media"
        Proc --> Web[Web-Optimized/]
        Proc --> ERP[ERP-Integrated/]
        Proc --> Social[Social-Media-Posts/]
    end
    
    subgraph "Palace of Fragrances"
        PF --> Precious[Precious-Range/]
        PF --> Classic[Classic-Range/]
        
        Precious --> OptimumGold[Objet-d-Art-Optimum-Precious-Gold/]
        Precious --> SterlinSilver[Objet-d-Art-Luxury-Sterling-Silver/]
        
        Classic --> Amethyst[Opulent-Shaik-Amethyst/]
        Classic --> Sapphire[Opulent-Shaik-Sapphire/]
        Classic --> Emerald[Chic-Shaik-Emerald/]
        Classic --> Onyx[Sochi-Onyx/]
        Classic --> Amber[Amber-Kroud/]
    end
    
    Root --> Meta
    Root --> Proc
    Root --> PF
    Root --> PP
    Root --> PS
    
    style Root fill:#f9f9f9
    style Meta fill:#e3f2fd
    style Proc fill:#e8f5e8
    style PF fill:#fce4ec
    style PP fill:#fff3e0
    style PS fill:#f3e5f5
  </div>

  <h3>File Naming Convention</h3>
  <div class="highlight">
    <strong>Pattern:</strong> <code>{ProductName}_{SKU}_{descriptor}_{timestamp}.{extension}</code>
    <br><br>
    <strong>Examples:</strong>
    <ul>
      <li><code>Opulent-Shaik-Amethyst_OSA-GE-100_original_20250703.jpg</code></li>
      <li><code>Objet-d-Art-Optimum_OAO-FL-50_web_optimized.webp</code></li>
      <li><code>AstroTime-MK1_ATM-IG-001_ai_metadata.json</code></li>
    </ul>
  </div>

  <h3>Folder Hierarchy Example</h3>
  <pre><code>DSI-Product-Repository/
‚îú‚îÄ‚îÄ Metadata/
‚îÇ   ‚îú‚îÄ‚îÄ Tagging-Data/
‚îÇ   ‚îú‚îÄ‚îÄ AI-Generated-Tags/
‚îÇ   ‚îú‚îÄ‚îÄ Multilingual-Descriptions/
‚îÇ   ‚îú‚îÄ‚îÄ Version-Control/
‚îÇ   ‚îú‚îÄ‚îÄ Media-Change-History/
‚îÇ   ‚îî‚îÄ‚îÄ Approval-Stages/
‚îú‚îÄ‚îÄ Processed-Media/
‚îÇ   ‚îú‚îÄ‚îÄ Web-Optimized/
‚îÇ   ‚îú‚îÄ‚îÄ ERP-Integrated/
‚îÇ   ‚îî‚îÄ‚îÄ Social-Media-Posts/
‚îú‚îÄ‚îÄ Palace-of-Fragrances/
‚îÇ   ‚îú‚îÄ‚îÄ Precious-Range/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Objet-d-Art-Optimum-Precious-Gold/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Objet-d-Art-Luxury-Sterling-Silver/
‚îÇ   ‚îî‚îÄ‚îÄ Classic-Range/
‚îÇ       ‚îú‚îÄ‚îÄ Opulent-Shaik-Amethyst/
‚îÇ       ‚îú‚îÄ‚îÄ Opulent-Shaik-Sapphire/
‚îÇ       ‚îú‚îÄ‚îÄ Chic-Shaik-Emerald/
‚îÇ       ‚îú‚îÄ‚îÄ Sochi-Onyx/
‚îÇ       ‚îî‚îÄ‚îÄ Amber-Kroud/
‚îú‚îÄ‚îÄ Palace-of-Precision/
‚îî‚îÄ‚îÄ Palace-of-Style/</code></pre>
</section>

<section id="workflows">
  <h2>‚öôÔ∏è Automated Workflow Processes</h2>
  
  <h3>Complete End-to-End Process Flow</h3>
  <div class="mermaid">
flowchart TB
    subgraph "Phase 1: Ingestion"
        Upload[File Upload] --> Detection[Auto-Detection]
        Detection --> Backup[QNAP Backup]
        Backup --> Log[Change Log]
    end
    
    subgraph "Phase 2: AI Processing" 
        Log --> AI[Weaviate Analysis]
        AI --> Tags[Generate Tags]
        Tags --> Meta[Create Metadata]
    end
    
    subgraph "Phase 3: CDN Distribution"
        Meta --> CDN[Cloudinary Upload]
        CDN --> Optimize[Auto-Optimization]
        Optimize --> URLs[Generate URLs]
    end
    
    subgraph "Phase 4: Integration"
        URLs --> ERP[ERP Integration]
        URLs --> Social[Social Media Variants]
        URLs --> Web[Web Distribution]
    end
    
    Web --> Final[Media Ready for Distribution]
    
    style Upload fill:#e1f5fe
    style AI fill:#f3e5f5
    style CDN fill:#fce4ec
    style Final fill:#e8f5e8
  </div>

  <h3>Workflow 1: Media Ingestion & Backup</h3>
  <ol>
    <li><strong>File Upload to Product Folder</strong> ‚Üí Detect File via Google Drive API</li>
    <li><strong>Extract Product Name & SKU</strong> from Folder Path</li>
    <li><strong>Log File Information</strong> in Tracking System</li>
    <li><strong>Trigger QNAP NAS Backup Sync</strong></li>
    <li><strong>Create Initial Metadata Record</strong></li>
    <li><strong>Send Google Chat Notification</strong></li>
    <li><strong>Complete:</strong> Update <code>/Metadata/Media-Change-History/{ProductName}_{SKU}_change_log.json</code></li>
    <li><strong>File Ready for AI Processing</strong></li>
  </ol>
  
  <div class="note">
    <strong>Output Location:</strong><br>
    <code>/Metadata/Media-Change-History/{ProductName}_{SKU}_change_log.json</code>
  </div>

  <h3>Workflow 2: AI Tagging & Metadata Enrichment</h3>
  <ol>
    <li><strong>Trigger: Media Ingestion Complete</strong> ‚Üí Send File to Weaviate for AI Analysis</li>
    <li><strong>Generate Vector Embeddings</strong></li>
    <li><strong>Extract Metadata</strong> - Objects, Colors, Themes</li>
    <li><strong>Apply Product Context</strong> from Folder Structure</li>
    <li><strong>Generate Multilingual Descriptions</strong></li>
    <li><strong>Store Enriched Metadata</strong> in Weaviate</li>
    <li><strong>Create Metadata Files:</strong>
      <ul>
        <li><code>/Metadata/AI-Generated-Tags/{ProductName}_{SKU}_ai_metadata.json</code></li>
        <li><code>/Metadata/Tagging-Data/{ProductName}_{SKU}_tags.json</code></li>
      </ul>
    </li>
    <li><strong>Trigger CDN Upload Workflow</strong></li>
  </ol>

  <h3>Workflow 3: CDN Upload & Optimization</h3>
  <ol>
    <li><strong>Start: AI Tagging Complete</strong> ‚Üí Upload Images to Cloudinary with Auto-optimization</li>
    <li><strong>Upload Videos</strong> to Vidjet Platform</li>
    <li><strong>Generate Multiple Format Variants</strong> - WebP, Different Resolutions</li>
    <li><strong>Create CDN URLs</strong> with Product Name Reference</li>
    <li><strong>Store CDN Links</strong> with Original File Path Mapping</li>
    <li><strong>Update Processed Media Folder</strong></li>
    <li><strong>Complete:</strong> Update <code>/Processed-Media/Web-Optimized/{ProductName}_{SKU}_cloudinary_urls.json</code></li>
    <li><strong>Send Completion Notification</strong></li>
  </ol>
</section>

<section id="implementation">
  <h2>üîß Technical Implementation</h2>

  <h3>Option A: Simplified Google Workspace Approach (Recommended)</h3>
  <div class="highlight">
    <strong>Best for:</strong> SMB teams with existing Google Workspace accounts
  </div>

  <h4>n8n Workflow Configuration</h4>
  <pre><code>{
  "workflowName": "DSI Media Upload Processor",
  "trigger": {
    "type": "Google Drive Trigger",
    "settings": {
      "authentication": "oAuth2",
      "resource": "file", 
      "event": "fileCreated",
      "folderId": "{{ $env.DSI_DRIVE_FOLDER_ID }}",
      "watchSubfolders": true,
      "fileTypes": ["image/jpeg", "image/png", "image/webp", "video/mp4", "video/mov"],
      "pollInterval": 300,
      "excludePaths": ["Archives", "Metadata", "System-Integration"]
    }
  },
  "filters": [{
    "type": "IF", 
    "condition": "{{ $json.path.includes('Product-Images') || $json.path.includes('Videos') || $json.path.includes('3D-Renders') }}"
  }],
  "errorHandling": {
    "retryAttempts": 3,
    "retryDelay": 60,
    "errorNotification": "Google Chat"
  }
}</code></pre>

  <h4>Setup Steps for Google Workspace</h4>
  <ol>
    <li>In n8n, go to Credentials ‚Üí Add Credential ‚Üí Google Drive OAuth2 API</li>
    <li>Click "Connect my account" and sign in with your Google Workspace account</li>
    <li>Grant permissions for Drive access</li>
    <li>No need for separate GCP project or client IDs!</li>
  </ol>

  <h3>Environment Variables (Simplified Google Workspace Approach)</h3>
  <pre><code># DSI Repository  
DSI_DRIVE_FOLDER_ID=your_root_folder_id

# AI & Vector Storage
WEAVIATE_API_KEY=your_weaviate_key
WEAVIATE_ENDPOINT=your_weaviate_url
OPENAI_API_KEY=your_openai_key

# CDN & Optimization
CLOUDINARY_CLOUD_NAME=your_cloud_name
CLOUDINARY_API_KEY=your_api_key  
CLOUDINARY_API_SECRET=your_api_secret

# Notifications (Optional)
GOOGLE_CHAT_WEBHOOK=your_chat_webhook_url</code></pre>

  <h3>Sample Output File Structure</h3>
  <pre><code>{
  "productName": "Opulent-Shaik-Amethyst",
  "sku": "OSA-GE-100",
  "originalFilePath": "/Palace-of-Fragrances/Classic-Range/Opulent-Shaik-Amethyst/Gold-Edition-for-Men/100ml/Product-Images/",
  "cloudinaryUrls": {
    "original": "https://res.cloudinary.com/dsi/image/upload/v1720000000/products/Opulent-Shaik-Amethyst_OSA-GE-100_original.jpg",
    "webOptimized": "https://res.cloudinary.com/dsi/image/upload/f_webp,q_auto/v1720000000/products/Opulent-Shaik-Amethyst_OSA-GE-100_web.webp",
    "thumbnail": "https://res.cloudinary.com/dsi/image/upload/w_300,h_300,c_fill/v1720000000/products/Opulent-Shaik-Amethyst_OSA-GE-100_thumb.jpg"
  },
  "metadata": {
    "uploadDate": "2025-07-03T10:30:00Z",
    "fileSize": "2.5MB",
    "dimensions": "1920x1080",
    "aiTags": ["perfume", "bottle", "gold", "luxury"],
    "category": "Palace-of-Fragrances",
    "range": "Classic-Range"
  }
}</code></pre>
</section>

<section id="database">
  <h2>üóÑÔ∏è Database Design</h2>

  <h3>Weaviate Schema Configuration</h3>
  <pre><code>{
  "classes": [{
    "class": "MediaAsset",
    "vectorizer": "text2vec-openai",
    "properties": [
      {"name": "productName", "dataType": ["string"]},
      {"name": "sku", "dataType": ["string"]},
      {"name": "description", "dataType": ["text"]},
      {"name": "tags", "dataType": ["string[]"]},
      {"name": "fileUrl", "dataType": ["string"]},
      {"name": "processingStatus", "dataType": ["string"]},
      {"name": "driveFileId", "dataType": ["string"]},
      {"name": "timestamp", "dataType": ["date"]}
    ]
  }]
}</code></pre>

  <h3>PostgreSQL Database Schema</h3>
  <pre><code>-- Media Assets Table
CREATE TABLE media_assets (
    id SERIAL PRIMARY KEY,
    drive_file_id VARCHAR(255) UNIQUE,
    weaviate_object_id UUID,
    product_name VARCHAR(255),
    sku VARCHAR(100),
    file_url TEXT,
    processing_status VARCHAR(50),
    ai_description TEXT,
    ai_tags TEXT[],
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- Processing Logs Table
CREATE TABLE processing_logs (
    id SERIAL PRIMARY KEY,
    media_asset_id INTEGER REFERENCES media_assets(id),
    workflow_execution_id VARCHAR(255),
    step_name VARCHAR(100),
    status VARCHAR(50),
    error_message TEXT,
    processing_time INTERVAL,
    created_at TIMESTAMP DEFAULT NOW()
);

-- Indexes for Performance
CREATE INDEX idx_media_assets_sku ON media_assets(sku);
CREATE INDEX idx_media_assets_status ON media_assets(processing_status);
CREATE INDEX idx_processing_logs_asset_id ON processing_logs(media_asset_id);
CREATE INDEX idx_processing_logs_status ON processing_logs(status);</code></pre>
</section>

<section id="deployment">
  <h2>üöÄ Deployment & Hosting Options</h2>

  <div class="cost-comparison">
    <div class="cost-card">
      <h4>Option A: n8n.cloud + Self-hosted Weaviate</h4>
      <p class="cost-price">~$27/month</p>
      <ul>
        <li><strong>Components:</strong> n8n (managed cloud service), Weaviate (VPS deployment), PostgreSQL (VPS deployment)</li>
        <li><strong>Ideal For:</strong> Quick PoC, low operational overhead</li>
        <li><strong>Complexity:</strong> Low</li>
      </ul>
    </div>
    <div class="cost-card">
      <h4>Option B: Fully Self-hosted</h4>
      <p class="cost-price">~$12/month</p>
      <ul>
        <li><strong>Components:</strong> All services on Docker containers, single VPS or local server</li>
        <li><strong>Ideal For:</strong> Cost-sensitive teams, full control</li>
        <li><strong>Complexity:</strong> Medium</li>
      </ul>
    </div>
    <div class="cost-card">
      <h4>Option C: Kubernetes Cluster</h4>
      <p class="cost-price">~$60+/month</p>
      <ul>
        <li><strong>Components:</strong> Helm charts for all services, auto-scaling capabilities, TLS Ingress, Load balancing</li>
        <li><strong>Ideal For:</strong> Production scale, high availability</li>
        <li><strong>Complexity:</strong> High</li>
      </ul>
    </div>
    <div class="cost-card">
      <h4>Option D: AWS Enterprise</h4>
      <p class="cost-price">~$150-300/month</p>
      <ul>
        <li><strong>Components:</strong> ALB (Application Load Balancer), EC2 instances, RDS (managed PostgreSQL), S3 storage, IAM security</li>
        <li><strong>Ideal For:</i> Enterprise SLA requirements</li>
        <li><strong>Complexity:</strong> Very High</li>
      </ul>
    </div>
  </div>

  <h3>Deployment Architecture Visualizations</h3>
  <div class="deployment-graph-container">
    <div>
      <h3>Development Stack (n8n.cloud + VPS)</h3>
      <div class="mermaid">
        graph TD
            subgraph "n8n.cloud (Managed Service)"
                N8NC[n8n Cloud Workflow]
            end
            subgraph "Self-Hosted VPS"
                WV_VPS[Weaviate Database]
                PG_VPS[PostgreSQL Database]
            end
            GD_Dev[Google Drive File Upload] --> N8NC
            N8NC -->|API Calls| WV_VPS
            N8NC -->|API Calls| PG_VPS
            N8NC -->|API Calls| OAI_Dev[OpenAI]
            N8NC -->|API Calls| CDN_Dev[Cloudinary CDN]
            N8NC -->|Notifications| GC_Dev[Google Chat]
      </div>
      <p style="text-align: center; font-style: italic; color: #555;">This setup is ideal for quick prototyping and small to medium-sized operations.</p>
    </div>

    <div>
      <h3>Production Stack (Kubernetes Cluster)</h3>
      <div class="mermaid">
        graph TD
            subgraph "Kubernetes Cluster (EKS/GKE)"
                N8N_K8S[n8n Workers<br/>Pods] -- Traffic --> K8S_LB[Kubernetes Load Balancer]
                N8N_K8S --> WV_K8S[Weaviate Service]
                N8N_K8S --> PG_K8S[PostgreSQL Service]
                WV_K8S --> K8S_STORAGE_WV[Persistent Storage<br/>e.g., EBS]
                PG_K8S --> K8S_STORAGE_PG[Persistent Storage<br/>e.g., EBS]
            end
            GD_Prod[Google Drive<br/>File Upload] -- Pub/Sub Event --> PUB_SUB[Google Pub/Sub]
            PUB_SUB -- Trigger --> K8S_LB
            N8N_K8S --> OAI_Prod[OpenAI]
            N8N_K8S --> CDN_Prod[Cloudinary CDN]
            N8N_K8S --> GC_Prod[Google Chat]
            
            style K8S_LB fill:#fff3e0
            style PUB_SUB fill:#cceeff
            style N8N_K8S fill:#f3e5f5
            style WV_K8S fill:#e8f5e8
            style PG_K8S fill:#e0f2f7
            style K8S_STORAGE_WV fill:#f8f8f8
            style K8S_STORAGE_PG fill:#f8f8f8
      </div>
      <p style="text-align: center; font-style: italic; color: #555;">Designed for scalability, high availability, and enterprise-grade performance.</p>
    </div>

    <div>
      <h3>Fully Self-hosted Stack (Docker Compose)</h3>
      <div class="mermaid">
        graph TD
            subgraph "Single VPS / Local Server (Docker Compose)"
                N8N_Local[n8n Container]
                WV_Local[Weaviate Container]
                PG_Local[PostgreSQL Container]
            end
            GD_Local[Google Drive<br/>File Upload] --> N8N_Local
            N8N_Local -->|Internal Network| WV_Local
            N8N_Local -->|Internal Network| PG_Local
            N8N_Local --> OAI_Local[OpenAI]
            N8N_Local --> CDN_Local[Cloudinary CDN]
            N8N_Local --> GC_Local[Google Chat]

            style N8N_Local fill:#f3e5f5
            style WV_Local fill:#e8f5e8
            style PG_Local fill:#e0f2f7
      </div>
      <p style="text-align: center; font-style: italic; color: #555;">Offers full control and cost-effectiveness for smaller-scale deployments.</p>
    </div>
  </div>

  <h3>Docker Compose Setup (Fully Self-hosted)</h3>
  <pre><code>version: '3.4'
services:
  weaviate:
    image: cr.weaviate.io/semitechnologies/weaviate:1.31.5
    ports: ["8080:8080"]
    volumes: [weaviate_data:/var/lib/weaviate]
    environment:
      QUERY_DEFAULTS_LIMIT: 25
      AUTHENTICATION_ANONYMOUS_ACCESS_ENABLED: 'true'
      DEFAULT_VECTORIZER_MODULE: text2vec-openai
      OPENAI_APIKEY: ${OPENAI_API_KEY}

  postgres:
    image: postgres:14
    environment:
      POSTGRES_DB: metadata
      POSTGRES_USER: dsiuser
      POSTGRES_PASSWORD: ${DB_PASSWORD}
    volumes: [postgres_data:/var/lib/postgresql/data]
    ports: ["5432:5432"]

  n8n:
    image: n8nio/n8n:latest
    ports: ["5678:5678"]
    environment:
      DB_TYPE: postgresdb
      DB_POSTGRESDB_HOST: postgres
      DB_POSTGRESDB_DATABASE: metadata
      DB_POSTGRESDB_USER: dsiuser
      DB_POSTGRESDB_PASSWORD: ${DB_PASSWORD}
      N8N_BASIC_AUTH_ACTIVE: 'true'
      N8N_BASIC_AUTH_USER: admin
      N8N_BASIC_AUTH_PASSWORD: ${N8N_PASSWORD}
    volumes: [n8n_data:/home/node/.n8n]
    depends_on: [postgres]</code></pre>

  <h3>Kubernetes Production Deployment Steps</h3>
  <h4>Create Amazon EKS Cluster</h4>
  <pre><code>eksctl create cluster --name dsi-media-prod \
  --region us-east-1 --version 1.29 \
  --nodegroup-name ng-spot --nodes 3 --nodes-min 2 --nodes-max 6 \
  --managed --node-type t3.large</code></pre>

  <h4>Deploy Services (Helm Charts)</h4>
  <pre><code># RabbitMQ
helm repo add bitnami https://charts.bitnami.com/bitnami
helm install dsi-rmq bitnami/rabbitmq \
  --set auth.username=dsi --set auth.password=securepass

# n8n Worker
helm repo add n8n https://8gears.container-registry.com/chartrepo/library
helm install n8n-workflow n8n/n8n \
  --set n8n.image.tag=latest \
  --set rabbitmq.enabled=false \
  --set externalRabbitmq=true \
  --set externalRabbitmq.host=dsi-rmq-rabbitmq \
  --set externalRabbitmq.port=5672 \
  --set persistence.enabled=true

# Weaviate
helm repo add weaviate https://weaviate.github.io/weaviate-helm
helm install weaviate weaviate/weaviate \
  --set env.OPENAI_APIKEY=$OPENAI_API_KEY

# PostgreSQL
helm install dsi-pg bitnami/postgresql \
  --set auth.username=dsi \
  --set auth.password=$DB_PASSWORD \
  --set primary.persistence.size=50Gi</code></pre>
</section>

<section id="security">
  <h2>üîí Security & Compliance</h2>

  <h3>Data Protection Strategy</h3>
  <div class="mermaid">
    graph TD
        subgraph "Security Layers"
            API[API Key Management]
            TLS[TLS Encryption]
            IAM[Identity & Access Management]
            Audit[Audit Logging]
        end
        
        subgraph "Storage Security"
            Vault[Credential Vaults]
            Encrypt[Data Encryption at Rest]
            Backup[Secure Backup Strategy]
        end
        
        subgraph "Access Control"
            RBAC[Role-Based Access Control]
            MFA[Multi-Factor Authentication]
            Network[Network Security]
        end
        
        API --> Vault
        TLS --> Encrypt
        IAM --> RBAC
        Audit --> Backup
        
        style API fill:#e3f2fd
        style TLS fill:#e8f5e8
        style IAM fill:#fff3e0
        style Audit fill:#fce4ec
  </div>

  <h3>Security Requirements</h3>
  <div class="warning">
    <strong>Critical Security Measures:</strong>
    <ul>
      <li>All API keys stored in secure credential vaults</li>
      <li>Encrypted communication between all services</li>
      <li>Regular credential rotation schedule</li>
      <li>Access logging and audit trails</li>
      <li>Role-based permissions across all systems</li>
      <li>Least privilege access principles</li>
      <li>Regular access reviews and updates</li>
      <li>Secure backup and recovery procedures</li>
    </ul>
  </div>

  <h3>Compliance Standards</h3>
  <ul>
    <li><strong>GDPR</strong> - Compliant data handling</li>
    <li><strong>SOC 2 Type II</strong> - Security and availability controls</li>
    <li><strong>Regular Assessments</strong> - Regular security assessments</li>
    <li><strong>Data Retention</strong> - Data retention policies</li>
  </ul>
</section>

<section id="testing">
  <h2>üß™ Testing & Monitoring</h2>

  <h3>Testing Protocol</h3>
  <div class="mermaid">
flowchart TD
    Upload[1. Test Upload] --> Logs[2. Verify Logs]
    Logs --> Process[3. Process Validation]
    Process --> Output[4. Output Check]
    
    Upload --> UploadDetail[Upload test image to<br/>Product-Images folder]
    Logs --> LogDetail[Check n8n execution logs<br/>for trigger activation]
    Process --> ProcessDetail[Confirm workflow<br/>processes file correctly]
    Output --> OutputDetail[Verify Cloudinary URLs in<br/>Processed-Media folder]
    
    style Upload fill:#e1f5fe
    style Logs fill:#f3e5f5
    style Process fill:#fff3e0
    style Output fill:#e8f5e8
  </div>
  <ol>
    <li><strong>Test Upload:</strong> Upload test image to Product-Images folder.</li>
    <li><strong>Verify Logs:</strong> Check n8n execution logs for trigger activation.</li>
    <li><strong>Process Validation:</strong> Confirm workflow processes file correctly.</li>
    <li><strong>Output Check:</strong> Verify Cloudinary URLs in Processed-Media folder.</li>
  </ol>

  <h3>Performance Monitoring</h3>
  <div class="note">
    <strong>Key Metrics to Track:</strong>
    <ul>
      <li>Execution logging in n8n</li>
      <li>Failed triggers or timeouts</li>
      <li>Upload frequency and polling interval optimization</li>
      <li>CDN upload success rates</li>
      <li>API call response times</li>
      <li>Storage usage and growth rates</li>
    </ul>
  </div>

  <h3>Error Handling Strategy</h3>
  <ul>
    <li><strong>Automated Recovery:</strong>
      <ul>
        <li>Retry logic for failed API calls (3 attempts with 60s delay)</li>
        <li>Google Chat notifications for errors</li>
        <li>Fallback to manual processing</li>
        <li>Webhook delivery failure monitoring</li>
      </ul>
    </li>
    <li><strong>Manual Intervention Triggers:</strong>
      <ul>
        <li>Three consecutive workflow failures</li>
        <li>API rate limit exceeded</li>
        <li>Storage capacity warnings</li>
        <li>Security alerts</li>
      </ul>
    </li>
  </ul>
</section>

<section id="best-practices">
  <h2>‚≠ê Best Practices & Optimization</h2>

  <h3>Performance Optimization</h3>
  <ul>
    <li><strong>Event-driven Architecture:</strong>
      <ul>
        <li>Reduce latency with real-time triggers</li>
        <li>Minimize API quota usage</li>
        <li>Implement efficient polling strategies</li>
      </ul>
    </li>
    <li><strong>Infrastructure as Code:</strong>
      <ul>
        <li>Version control all configuration changes</li>
        <li>Automated deployment pipelines</li>
        <li>Environment-specific configurations</li>
      </ul>
    </li>
    <li><strong>Caching Strategy:</strong>
      <ul>
        <li>CDN edge caching for optimized media</li>
        <li>Database query optimization</li>
        <li>Vector search result caching</li>
      </ul>
    </li>
  </ul>

  <h3>Operational Excellence</h3>
  <ul>
    <li><strong>Monitoring & Alerting:</strong>
      <ul>
        <li>Prometheus + Grafana metrics</li>
        <li>CloudWatch integration for AWS deployments</li>
        <li>Custom dashboards for business metrics</li>
        </ul>
    </li>
    <li><strong>Backup & Recovery:</strong>
      <ul>
        <li>PostgreSQL automated dumps</li>
        <li>Weaviate vector database snapshots</li>
        <li>Google Drive incremental backups via QNAP</li>
        <li>Disaster recovery testing</li>
      </ul>
    </li>
    <li><strong>CI/CD Pipeline:</strong>
      <ul>
        <li>Automated testing for workflow changes</li>
        <li>Helm chart deployments</li>
        <li>Blue/green deployment strategy</li>
        <li>Rollback procedures</li>
      </ul>
    </li>
  </ul>

  <h3>Cost Optimization</h3>
  <ul>
    <li><strong>Resource Management:</strong>
      <ul>
        <li>Auto-scaling based on upload volume</li>
        <li>Scheduled shutdown for development environments</li>
        <li>CDN cost optimization through smart caching</li>
        <li>Storage tiering for archival data</li>
      </ul>
    </li>
    <li><strong>API Usage Optimization:</strong>
      <ul>
        <li>Batch processing where possible</li>
        <li>Efficient API call patterns</li>
        <li>Rate limiting and throttling</li>
        <li>Usage monitoring and alerting</li>
      </ul>
    </li>
  </ul>

  <h3>Implementation Roadmap</h3>
  <div class="highlight">
    <strong>Phase 1: Foundation</strong>
    <ul>
      <li>For Google Workspace Approach: Set up basic infrastructure (Docker containers), configure n8n with Google Workspace OAuth, deploy PostgreSQL instance, test file upload detection with your GWS account.</li>
      <li>For GCP Enterprise Approach: Set up GCP project and service accounts, configure Google Drive API access, deploy PostgreSQL and basic n8n instance, test file upload detection with service account.</li>
    </ul>
    
    <strong>Phase 2: Core Workflows </strong>
    <ul>
      <li>Implement media ingestion workflow, set up Weaviate integration, configure AI tagging pipeline, test end-to-end basic flow.</li>
    </ul>
    
    <strong>Phase 3: CDN Integration</strong>
    <ul>
      <li>Configure Cloudinary integration, implement optimization workflows, set up URL generation and mapping, test media distribution pipeline.</li>
    </ul>

    <strong>Phase 4: Production Hardening</strong>
    <ul>
      <li>Implement security measures, set up monitoring and alerting, configure backup procedures, performance testing and optimization.</li>
    </ul>

    <strong>Phase 5: Go-Live & Support</strong>
    <ul>
      <li>Production deployment, user training and documentation, ongoing monitoring and maintenance, continuous improvement.</li>
    </ul>
  </div>
</section>

</main>

<footer>
  <p>¬© 2025 DSI Media Repository Implementation Guide</p>
  <p>This documentation provides complete technical specifications for deploying the DSI Media Repository Integration Architecture with automated workflows from upload to CDN distribution.</p>
</footer>

</body>
</html>
